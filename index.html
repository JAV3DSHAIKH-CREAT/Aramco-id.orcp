<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>S019 - ARAMCO ID LOG</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>

<style>
:root{
    --dark-bg:#0f172a;
    --card-bg:#1e293b;
    --accent:#2563eb;
    --light:#e2e8f0;
    --muted:#94a3b8;
    --shadow:0 10px 25px rgba(0,0,0,0.4);
}

*{margin:0;padding:0;box-sizing:border-box}

body{
    font-family:'Poppins',sans-serif;
    background:var(--dark-bg);
    color:var(--light);
    height: 100vh;
    overflow: hidden;
}

header{
    position:relative;
    background:linear-gradient(135deg,#1e3a8a,#2563eb);
    padding: 20px;
    text-align:center;
    border-bottom-left-radius:30px;
    border-bottom-right-radius:30px;
    box-shadow:var(--shadow);
}

header h1{font-size:1.5rem;font-weight:600}
header p{font-size: 0.8rem; opacity:.8}

.logo{
    position:absolute;
    left:30px;
    top:50%;
    transform:translateY(-50%);
    width:60px;
    height:60px;
    object-fit:contain;
}

#showFullDataBtn{
    position:absolute;
    right:30px;
    top:50%;
    transform:translateY(-50%);
    padding:8px 12px;
    background:#22c55e;
    color:#0f172a;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
    font-size:0.85rem;
    box-shadow:var(--shadow);
}
#showFullDataBtn:hover{
    background:#16a34a;
}

.search-wrapper{
    max-width:500px;
    margin: 15px auto;
    position:relative;
    z-index: 10;
}

#mainSearch{
    width:100%;
    padding:12px 20px;
    border-radius:50px;
    border:1px solid #334155;
    font-size:0.9rem;
    outline:none;
    background:#1e293b;
    color:white;
    box-shadow:var(--shadow);
}

.suggestions{
    position:absolute;
    top:50px;left:0;right:0;
    background:#1e293b;
    border-radius:15px;
    max-height:200px;
    overflow-y:auto;
    display:none;
    box-shadow:var(--shadow);
    border:1px solid #334155;
}

.suggestion-item{
    padding:10px 20px;
    cursor:pointer;
    border-bottom:1px solid #334155;
    font-size: 0.9rem;
}
.suggestion-item:hover{ background:#2563eb; }

.container {
    max-width: 95%;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    flex-wrap: wrap;
    height: 70vh;
    gap: 15px;
    justify-content: flex-start;
    align-content: center;
}

.section-box {
    background: var(--card-bg);
    width: 48%;
    padding: 15px;
    border-radius: 15px;
    box-shadow: var(--shadow);
    border: 1px solid #334155;
}

.section-box h3{
    margin-bottom:12px;
    font-weight:700;
    font-size:1rem;
    color:#3b82f6;
    border-left:4px solid var(--accent);
    padding-left:10px;
}

.section-grid{
    display:grid;
    grid-template-columns: repeat(2, 1fr);
    gap:8px;
}

.info-card{
    background:#0f172a;
    padding:8px 12px;
    border-radius:10px;
    border:1px solid #334155;
}

.label{
    font-size:0.6rem;
    color:var(--muted);
    text-transform:uppercase;
    display: block;
}

.value{
    font-size:0.85rem;
    font-weight:500;
    word-break: break-all;
}

#statusMsg{
    text-align:center;
    margin-bottom:10px;
    font-size:.8rem;
    color:#22c55e;
}

footer{
    position:fixed;
    bottom:0;
    width:100%;
    text-align:center;
    padding:8px 0;
    background:#1e293b;
    color:var(--muted);
    font-size:0.75rem;
    box-shadow:var(--shadow);
}

@media(max-width:1000px){
    body { overflow-y: auto; height: auto; }
    .container { height: auto; flex-wrap: nowrap; align-content: stretch; }
    .section-box { width: 100%; }
}
</style>
</head>

<body>

<header>
    <img src="orcp.bmp" class="logo" alt="ORCP Logo">
    <h1>JAFFURAH - S019 ARAMCO ID DETAILS</h1>
    <p>PROFESSIONAL PERSONNEL DATABASE</p>
    <button id="showFullDataBtn">SHOW FULL DATA</button>
</header>

<div class="search-wrapper">
    <input type="text" id="mainSearch" placeholder="Search by FILE NO..." autocomplete="off">
    <div id="suggestions" class="suggestions"></div>
</div>

<div id="statusMsg">Connecting to Database...</div>

<div class="container" id="infoContainer">
</div>

<footer>
    Created by MOHAMMAD JAVED SHAIKH (603660)
</footer>

<script>
const FILE_URL='S019-ARAMCO ID LOG.xlsx';
let database=[];

async function loadExcel(){
    const status=document.getElementById('statusMsg');
    try{
        const response=await fetch(FILE_URL);
        const arrayBuffer=await response.arrayBuffer();
        const workbook=XLSX.read(arrayBuffer,{type:'array'});
        const sheet=workbook.Sheets["ARAMCO ID LOG - S019"];
        const raw=XLSX.utils.sheet_to_json(sheet,{defval:""});

        database=raw.map(row=>{
            let clean={};
            for(let key in row){
                clean[key.trim().toUpperCase()]=row[key];
            }
            return clean;
        });

        status.innerHTML="✅ Data Loaded: "+database.length+" Records Found";

    }catch(err){
        status.innerHTML="❌ Error: Ensure Excel file is in the same folder";
        console.error(err);
    }
}

const searchInput=document.getElementById('mainSearch');
const suggestBox=document.getElementById('suggestions');

searchInput.addEventListener('input',(e)=>{
    const query=e.target.value.toLowerCase().trim();
    suggestBox.innerHTML='';
    if(query.length<1){suggestBox.style.display='none';return;}

    const matches=database.filter(item=>
        String(item['FILE NO.']||"").toLowerCase().includes(query)
    ).slice(0,8);

    if(matches.length>0){
        suggestBox.style.display='block';
        matches.forEach(item=>{
            const div=document.createElement('div');
            div.className='suggestion-item';
            div.innerText=item['FILE NO.'] + " - " + (item['NAME'] || "");
            div.onclick=()=>renderDetails(item);
            suggestBox.appendChild(div);
        });
    }else{
        suggestBox.style.display='none';
    }
});

function renderDetails(person){
    searchInput.value=person['FILE NO.'];
    suggestBox.style.display='none';
    const container=document.getElementById('infoContainer');
    container.innerHTML='';

    function createSection(title,fields){
        let section=document.createElement('div');
        section.className='section-box';
        let html=`<h3>${title}</h3><div class="section-grid">`;

        fields.forEach(([label,key])=>{
            let value=person[key]||"N/A";
            let extraStyle="";

            if(label==="Gate Pass Status" && value.toString().toUpperCase()==="IN PROCESS"){
                extraStyle="color:#eab308;";
            } else if(label==="Gate Pass Status"){
                extraStyle="color:#22c55e;";
            }

            if(label.toLowerCase().includes('date') && typeof value==='number'){
                value=new Date((value-25569)*86400000).toLocaleDateString('en-GB');
            }

            html+=`
            <div class="info-card">
                <span class="label">${label}</span>
                <span class="value" style="${extraStyle}">${value}</span>
            </div>`;
        });

        html+=`</div>`;
        section.innerHTML=html;
        container.appendChild(section);
    }

    createSection("Company Info",[
        ["File No.","FILE NO."],
        ["Company","COMPANY"],
        ["Designation","DESIGNATION"],
        ["Gate Pass Status","GATE PASS STATUS"]
    ]);

    createSection("Personal Info",[
        ["Name","NAME"],
        ["DOB","DATE OF BIRTH"],
        ["Blood Type","BLOOD TYPE"],
        ["Nationality","NATIONALITY"],
        ["Religion","RELIGION"],
        ["Gender","GENDER"]
    ]);

    createSection("Iqama Info",[
        ["Iqama Number","IQAMA NO."],
        ["Issue Date","ISSUE DATE"],
        ["Expiry Date","EXPIRY DATE"]
    ]);

    createSection("Passport Info",[
        ["Passport Number","PASSPORT NO"],
        ["Place of Issue","PLACE OF ISSUE"],
        ["Issue Date","PP-ISSUE DATE"],
        ["Expiry Date","PP-EXPIRY DATE"]
    ]);

    createSection("Aramco ID Details",[
        ["Badge no","BADGE NO."],
        ["GP Apply Date","REQ DATE"],
        ["SA Req No.","SA REQ NO."],
        ["Appt Date","APP DATE"],
        ["ID office","ID OFFICE"],
        ["Issue Date","CARD ISSUE DATE"],
        ["Expiry Date","CARD EXPIRY DATE"],
        ["Remaining Days","REMAINING DAYS"],
        ["ID Location","CARD WITH"]
    ]);

    // CALCULATE REMAINING DAYS AND COLOR CHANGE
    const cards=document.querySelectorAll('.section-box');
    const lastSection=cards[cards.length-1];
    const infoCards=lastSection.querySelectorAll('.info-card');
    infoCards.forEach(card=>{
        const labelEl=card.querySelector('.label');
        if(labelEl.innerText==="Remaining Days"){
            const valueEl=card.querySelector('.value');
            const expNum=person["CARD EXPIRY DATE"];
            let remaining="N/A";
            if(typeof expNum==='number'){
                const dateExp=new Date((expNum-25569)*86400000);
                const today=new Date();
                remaining=Math.ceil((dateExp-today)/(1000*60*60*24));
                if(remaining<0) remaining=0;
            }
            valueEl.innerText=remaining + " Days";
            valueEl.style.color=remaining <=50 ? "#f87171" : "#22c55e";
        }
    });
}

// SHOW FULL DATA BUTTON WITH ORGANIZED TABLE AND FROZEN HEADER
document.getElementById('showFullDataBtn').addEventListener('click',()=>{
    const win=window.open("", "_blank");
    win.document.write(`<html><head><title>Full Data</title>
    <style>
        body{font-family:'Poppins',sans-serif; background:#0f172a; color:#e2e8f0; padding:20px;}
        .table-container{max-height:90vh; overflow:auto; border:1px solid #334155;}
        table{border-collapse:collapse; width:100%;}
        th, td{border:1px solid #334155; padding:6px 10px; text-align:left; white-space:nowrap;}
        th{background:#2563eb; color:#fff; position:sticky; top:0; z-index:2;}
        tr:nth-child(even){background:#1e293b;}
    </style>
    </head><body>
    <h2>FULL ARAMCO ID LOG DATA</h2>
    <div class="table-container"><table>
        <thead>
            <tr>`);

    if(database.length>0){
        const headers=Object.keys(database[0]);
        headers.forEach(h=>{
            win.document.write(`<th>${h}</th>`);
        });
        win.document.write(`</tr></thead><tbody>`);
        database.forEach(row=>{
            win.document.write(`<tr>`);
            headers.forEach(h=>{
                win.document.write(`<td>${row[h]}</td>`);
            });
            win.document.write(`</tr>`);
        });
        win.document.write(`</tbody>`);
    }

    win.document.write(`</table></div></body></html>`);
});

window.onload=loadExcel;

window.addEventListener('click',(e)=>{
    if(!e.target.closest('.search-wrapper')){
        suggestBox.style.display='none';
    }
});
</script>

</body>
</html>
